{"version":3,"file":"index.umd.js","sources":["../node_modules/traverse/index.js","../index.js"],"sourcesContent":["var traverse = module.exports = function (obj) {\n    return new Traverse(obj);\n};\n\nfunction Traverse (obj) {\n    this.value = obj;\n}\n\nTraverse.prototype.get = function (ps) {\n    var node = this.value;\n    for (var i = 0; i < ps.length; i ++) {\n        var key = ps[i];\n        if (!node || !hasOwnProperty.call(node, key)) {\n            node = undefined;\n            break;\n        }\n        node = node[key];\n    }\n    return node;\n};\n\nTraverse.prototype.has = function (ps) {\n    var node = this.value;\n    for (var i = 0; i < ps.length; i ++) {\n        var key = ps[i];\n        if (!node || !hasOwnProperty.call(node, key)) {\n            return false;\n        }\n        node = node[key];\n    }\n    return true;\n};\n\nTraverse.prototype.set = function (ps, value) {\n    var node = this.value;\n    for (var i = 0; i < ps.length - 1; i ++) {\n        var key = ps[i];\n        if (!hasOwnProperty.call(node, key)) node[key] = {};\n        node = node[key];\n    }\n    node[ps[i]] = value;\n    return value;\n};\n\nTraverse.prototype.map = function (cb) {\n    return walk(this.value, cb, true);\n};\n\nTraverse.prototype.forEach = function (cb) {\n    this.value = walk(this.value, cb, false);\n    return this.value;\n};\n\nTraverse.prototype.reduce = function (cb, init) {\n    var skip = arguments.length === 1;\n    var acc = skip ? this.value : init;\n    this.forEach(function (x) {\n        if (!this.isRoot || !skip) {\n            acc = cb.call(this, acc, x);\n        }\n    });\n    return acc;\n};\n\nTraverse.prototype.paths = function () {\n    var acc = [];\n    this.forEach(function (x) {\n        acc.push(this.path); \n    });\n    return acc;\n};\n\nTraverse.prototype.nodes = function () {\n    var acc = [];\n    this.forEach(function (x) {\n        acc.push(this.node);\n    });\n    return acc;\n};\n\nTraverse.prototype.clone = function () {\n    var parents = [], nodes = [];\n    \n    return (function clone (src) {\n        for (var i = 0; i < parents.length; i++) {\n            if (parents[i] === src) {\n                return nodes[i];\n            }\n        }\n        \n        if (typeof src === 'object' && src !== null) {\n            var dst = copy(src);\n            \n            parents.push(src);\n            nodes.push(dst);\n            \n            forEach(objectKeys(src), function (key) {\n                dst[key] = clone(src[key]);\n            });\n            \n            parents.pop();\n            nodes.pop();\n            return dst;\n        }\n        else {\n            return src;\n        }\n    })(this.value);\n};\n\nfunction walk (root, cb, immutable) {\n    var path = [];\n    var parents = [];\n    var alive = true;\n    \n    return (function walker (node_) {\n        var node = immutable ? copy(node_) : node_;\n        var modifiers = {};\n        \n        var keepGoing = true;\n        \n        var state = {\n            node : node,\n            node_ : node_,\n            path : [].concat(path),\n            parent : parents[parents.length - 1],\n            parents : parents,\n            key : path.slice(-1)[0],\n            isRoot : path.length === 0,\n            level : path.length,\n            circular : null,\n            update : function (x, stopHere) {\n                if (!state.isRoot) {\n                    state.parent.node[state.key] = x;\n                }\n                state.node = x;\n                if (stopHere) keepGoing = false;\n            },\n            'delete' : function (stopHere) {\n                delete state.parent.node[state.key];\n                if (stopHere) keepGoing = false;\n            },\n            remove : function (stopHere) {\n                if (isArray(state.parent.node)) {\n                    state.parent.node.splice(state.key, 1);\n                }\n                else {\n                    delete state.parent.node[state.key];\n                }\n                if (stopHere) keepGoing = false;\n            },\n            keys : null,\n            before : function (f) { modifiers.before = f },\n            after : function (f) { modifiers.after = f },\n            pre : function (f) { modifiers.pre = f },\n            post : function (f) { modifiers.post = f },\n            stop : function () { alive = false },\n            block : function () { keepGoing = false }\n        };\n        \n        if (!alive) return state;\n        \n        function updateState() {\n            if (typeof state.node === 'object' && state.node !== null) {\n                if (!state.keys || state.node_ !== state.node) {\n                    state.keys = objectKeys(state.node)\n                }\n                \n                state.isLeaf = state.keys.length == 0;\n                \n                for (var i = 0; i < parents.length; i++) {\n                    if (parents[i].node_ === node_) {\n                        state.circular = parents[i];\n                        break;\n                    }\n                }\n            }\n            else {\n                state.isLeaf = true;\n                state.keys = null;\n            }\n            \n            state.notLeaf = !state.isLeaf;\n            state.notRoot = !state.isRoot;\n        }\n        \n        updateState();\n        \n        // use return values to update if defined\n        var ret = cb.call(state, state.node);\n        if (ret !== undefined && state.update) state.update(ret);\n        \n        if (modifiers.before) modifiers.before.call(state, state.node);\n        \n        if (!keepGoing) return state;\n        \n        if (typeof state.node == 'object'\n        && state.node !== null && !state.circular) {\n            parents.push(state);\n            \n            updateState();\n            \n            forEach(state.keys, function (key, i) {\n                path.push(key);\n                \n                if (modifiers.pre) modifiers.pre.call(state, state.node[key], key);\n                \n                var child = walker(state.node[key]);\n                if (immutable && hasOwnProperty.call(state.node, key)) {\n                    state.node[key] = child.node;\n                }\n                \n                child.isLast = i == state.keys.length - 1;\n                child.isFirst = i == 0;\n                \n                if (modifiers.post) modifiers.post.call(state, child);\n                \n                path.pop();\n            });\n            parents.pop();\n        }\n        \n        if (modifiers.after) modifiers.after.call(state, state.node);\n        \n        return state;\n    })(root).node;\n}\n\nfunction copy (src) {\n    if (typeof src === 'object' && src !== null) {\n        var dst;\n        \n        if (isArray(src)) {\n            dst = [];\n        }\n        else if (isDate(src)) {\n            dst = new Date(src.getTime ? src.getTime() : src);\n        }\n        else if (isRegExp(src)) {\n            dst = new RegExp(src);\n        }\n        else if (isError(src)) {\n            dst = { message: src.message };\n        }\n        else if (isBoolean(src)) {\n            dst = new Boolean(src);\n        }\n        else if (isNumber(src)) {\n            dst = new Number(src);\n        }\n        else if (isString(src)) {\n            dst = new String(src);\n        }\n        else if (Object.create && Object.getPrototypeOf) {\n            dst = Object.create(Object.getPrototypeOf(src));\n        }\n        else if (src.constructor === Object) {\n            dst = {};\n        }\n        else {\n            var proto =\n                (src.constructor && src.constructor.prototype)\n                || src.__proto__\n                || {}\n            ;\n            var T = function () {};\n            T.prototype = proto;\n            dst = new T;\n        }\n        \n        forEach(objectKeys(src), function (key) {\n            dst[key] = src[key];\n        });\n        return dst;\n    }\n    else return src;\n}\n\nvar objectKeys = Object.keys || function keys (obj) {\n    var res = [];\n    for (var key in obj) res.push(key)\n    return res;\n};\n\nfunction toS (obj) { return Object.prototype.toString.call(obj) }\nfunction isDate (obj) { return toS(obj) === '[object Date]' }\nfunction isRegExp (obj) { return toS(obj) === '[object RegExp]' }\nfunction isError (obj) { return toS(obj) === '[object Error]' }\nfunction isBoolean (obj) { return toS(obj) === '[object Boolean]' }\nfunction isNumber (obj) { return toS(obj) === '[object Number]' }\nfunction isString (obj) { return toS(obj) === '[object String]' }\n\nvar isArray = Array.isArray || function isArray (xs) {\n    return Object.prototype.toString.call(xs) === '[object Array]';\n};\n\nvar forEach = function (xs, fn) {\n    if (xs.forEach) return xs.forEach(fn)\n    else for (var i = 0; i < xs.length; i++) {\n        fn(xs[i], i, xs);\n    }\n};\n\nforEach(objectKeys(Traverse.prototype), function (key) {\n    traverse[key] = function (obj) {\n        var args = [].slice.call(arguments, 1);\n        var t = new Traverse(obj);\n        return t[key].apply(t, args);\n    };\n});\n\nvar hasOwnProperty = Object.hasOwnProperty || function (obj, key) {\n    return key in obj;\n};\n","import traverse from \"traverse\";\n\n// from https://github.com/madprime/python-gedcom/blob/master/gedcom/__init__.py\n// * Level must start with nonnegative int, no leading zeros.\n// * Pointer optional, if it exists it must be flanked by '@'\n// * Tag must be alphanumeric string\n// * Value optional, consists of anything after a space to end of line\n//   End of line defined by \\n or \\r\nconst lineRe = /\\s*(0|[1-9]+[0-9]*) (@[^@]+@ |)([A-Za-z0-9_]+)( [^\\n\\r]*|)/;\n\nfunction hasTag(val) {\n  return node => node.tag === val;\n}\n\nexport function d3ize(tree) {\n  var peopleNodes = tree.filter(hasTag(\"INDI\")).map(toNode);\n  const families = tree.filter(hasTag(\"FAM\"));\n  const familyNodes = families.map(toNode);\n  let links = [].concat(...families.map(familyLinks));\n  const allNodes = peopleNodes.concat(familyNodes);\n  const indexedNodes = allNodes.reduce(function(memo, node, i) {\n    memo[node.id] = i;\n    return memo;\n  }, {});\n  links = links.map(idToIndex(indexedNodes));\n  return {\n    nodes: allNodes,\n    links: links\n  };\n}\n\nfunction getName(p) {\n  if (p.tag === \"INDI\") {\n    var nameNode = (p.tree.filter(hasTag(\"NAME\")) || [])[0];\n    if (nameNode) {\n      return nameNode.data.replace(/\\//g, \"\");\n    } else {\n      return \"?\";\n    }\n  } else {\n    return \"Family\";\n  }\n}\n\nfunction toNode(p) {\n  p.id = p.pointer;\n  p.name = getName(p);\n  return p;\n}\n\nfunction idToIndex(indexedNodes) {\n  return link => ({\n    source: indexedNodes[link.source],\n    target: indexedNodes[link.target]\n  });\n}\n\nfunction familyLinks(family) {\n  return family.tree\n    .filter(member => {\n      // avoid connecting MARR, etc: things that are not\n      // people.\n      return member.data && member.data[0] === \"@\";\n    })\n    .map(member => ({\n      source: family.pointer,\n      target: member.data\n    }));\n}\n\nexport function parse(input) {\n  const start = { root: { tree: [] }, level: 0 };\n  start.pointer = start.root;\n\n  return traverse(\n    input\n      .split(\"\\n\")\n      .map(mapLine)\n      .filter(function(_) {\n        return _;\n      })\n      .reduce(buildTree, start).root.tree\n  ).map(function(node) {\n    delete node.up;\n    delete node.level;\n    this.update(node);\n  });\n\n  // the basic trick of this module is turning the suggested tree\n  // structure of a GEDCOM file into a tree in JSON. This reduction\n  // does that. The only real trick is the `.up` member of objects\n  // that points to a level up in the structure. This we have to\n  // censor before JSON.stringify since it creates circular references.\n  function buildTree(memo, data) {\n    if (data.level === memo.level) {\n      memo.pointer.tree.push(data);\n    } else if (data.level > memo.level) {\n      const up = memo.pointer;\n      memo.pointer = memo.pointer.tree[memo.pointer.tree.length - 1];\n      memo.pointer.tree.push(data);\n      memo.pointer.up = up;\n      memo.level = data.level;\n    } else if (data.level < memo.level) {\n      // the jump up in the stack may be by more than one, so ascend\n      // until we're at the right level.\n      while (data.level <= memo.pointer.level && memo.pointer.up) {\n        memo.pointer = memo.pointer.up;\n      }\n      memo.pointer.tree.push(data);\n      memo.level = data.level;\n    }\n    return memo;\n  }\n\n  function mapLine(data) {\n    const match = data.match(lineRe);\n    if (!match) return null;\n    return {\n      level: parseInt(match[1], 10),\n      pointer: match[2].trim(),\n      tag: match[3].trim(),\n      data: match[4].trim(),\n      tree: []\n    };\n  }\n}\n"],"names":["traverse","module","obj","Traverse","this","value","walk","root","cb","immutable","path","parents","alive","walker","node_","modifiers","keepGoing","state","node","copy","concat","parent","length","key","slice","isRoot","level","circular","update","x","stopHere","delete","remove","isArray","splice","keys","before","f","after","pre","post","stop","block","updateState","objectKeys","isLeaf","i","notLeaf","notRoot","ret","call","undefined","push","forEach","child","hasOwnProperty","isLast","isFirst","pop","src","dst","toS","Date","getTime","isRegExp","RegExp","isError","message","isBoolean","Boolean","isNumber","Number","isString","String","Object","create","getPrototypeOf","constructor","T","prototype","__proto__","get","ps","has","set","map","reduce","init","skip","arguments","acc","paths","nodes","clone","res","toString","Array","xs","fn","args","t","apply","lineRe","hasTag","val","tag","toNode","p","id","pointer","name","nameNode","tree","filter","data","replace","getName","familyLinks","family","member","source","target","peopleNodes","families","familyNodes","links","ref","allNodes","indexedNodes","memo","link","idToIndex","input","const","start","split","match","parseInt","trim","_","up"],"mappings":"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"}